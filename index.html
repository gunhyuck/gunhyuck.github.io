<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë¦¼ì• ë¹„ë‰´ ë™íƒ„1ì°¨ ì…ì£¼ìì¹´ë“œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        window.jsPDF = window.jspdf.jsPDF;
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 5px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo {
            height: 80px;
            width: auto;
            margin-right: 15px;
            max-width: 200px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-size: 13px;
        }

        /* ===== íƒ­ ìŠ¤íƒ€ì¼ ===== */
        .tab-container {
            display: flex;
            gap: 4px;
            margin: 15px 0 0 0;
            border-bottom: 3px solid #667eea;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 14px 24px;
            font-size: 15px;
            font-weight: 700;
            border: 2px solid #ddd;
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            background: #f0f0f0;
            color: #888;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            top: 3px;
        }

        .tab-button:hover {
            background: #e8e8e8;
            color: #555;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            border-color: #667eea;
            border-bottom: 3px solid white;
            top: 3px;
        }

        .tab-button .tab-icon {
            margin-right: 8px;
        }

        .tab-content {
            display: none;
            padding-top: 15px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== ê³µí†µ í¼ ìŠ¤íƒ€ì¼ ===== */
        .section {
            margin: 12px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            color: #444;
            font-weight: 600;
            font-size: 13px;
        }

        label .required {
            color: #e74c3c;
            margin-left: 3px;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"],
        .checkbox-group input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .employee-list, .owner-info {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .employee-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            position: relative;
        }

        .employee-item h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .btn-remove-employee {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-add-employee {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        button {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-save {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-pdf {
            flex: 1;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-reset {
            flex: 1;
            background: #f1f3f5;
            color: #495057;
        }

        .btn-reset:hover {
            background: #e9ecef;
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #c3e6cb;
            text-align: center;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notice-box {
            background: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            border-left: 4px solid #ffc107;
            font-size: 12px;
            line-height: 1.4;
            color: #856404;
        }

        .consent-box {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 8px;
            margin: 12px 0;
            border-left: 4px solid #17a2b8;
        }

        .consent-box h3 {
            color: #0c5460;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .consent-box p {
            color: #0c5460;
            line-height: 1.5;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .consent-checkbox {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .consent-checkbox label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .consent-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .contact-info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 8px;
            margin: 12px 0;
            text-align: center;
            font-size: 11px;
            color: #004085;
        }

        .contact-info strong {
            color: #667eea;
        }

        /* ===== ëŒ€ì¥ í…Œì´ë¸” ìŠ¤íƒ€ì¼ (í‚¤ë¶ˆì¶œ / ê³µê¸°êµ¬ëŒ€ì—¬) ===== */
        .ledger-title {
            text-align: center;
            font-size: 22px;
            font-weight: 800;
            color: #333;
            margin: 10px 0 5px 0;
        }

        .ledger-subtitle {
            text-align: center;
            font-size: 13px;
            color: #888;
            margin-bottom: 15px;
        }

        .ledger-date-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: flex-end;
        }

        .ledger-date-row label {
            font-weight: 600;
            color: #444;
            margin-bottom: 0;
        }

        .ledger-date-row input {
            width: 180px;
        }

        .ledger-table-wrapper {
            overflow-x: auto;
            margin: 10px 0;
        }

        .ledger-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .ledger-table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 13px;
            border: 1px solid #5a6fd6;
            white-space: nowrap;
        }

        .ledger-table thead th.sub-header {
            background: linear-gradient(135deg, #7b8ff0 0%, #8e5cb5 100%);
            font-size: 12px;
            padding: 8px;
        }

        .ledger-table tbody td {
            padding: 4px;
            border: 1px solid #dee2e6;
            text-align: center;
            vertical-align: middle;
        }

        .ledger-table tbody td input {
            border: none;
            background: transparent;
            text-align: center;
            padding: 6px 4px;
            font-size: 13px;
            width: 100%;
            border-radius: 0;
        }

        .ledger-table tbody td input:focus {
            background: #f0f3ff;
            box-shadow: inset 0 0 0 2px #667eea;
            border-radius: 4px;
        }

        .ledger-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .ledger-table tbody tr:hover {
            background: #e8ecff;
        }

        .ledger-table .row-number {
            font-weight: 700;
            color: #667eea;
            width: 40px;
            background: #f0f3ff;
        }

        .btn-add-row {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .btn-add-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-remove-row {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }

        .btn-remove-row:hover {
            background: #c82333;
        }

        .ledger-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* ===== íƒ­ë³„ ìƒ‰ìƒ ===== */
        .section.key-section {
            border-left-color: #e67e22;
        }

        .section.tool-section {
            border-left-color: #27ae60;
        }

        @media (max-width: 768px) {
            .tab-button {
                padding: 10px 14px;
                font-size: 13px;
            }
            .ledger-table {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <img src="https://i.imgur.com/placeholder.png" alt="ì¹´ë¦¼ì• ë¹„ë‰´ ë¡œê³ " class="logo" onerror="this.style.display='none'">
            ì¹´ë¦¼ì• ë¹„ë‰´ ë™íƒ„1ì°¨
        </h1>
        <p class="subtitle">ì…ì£¼ìì¹´ë“œ ë° ê´€ë¦¬ëŒ€ì¥ ì–‘ì‹</p>

        <div class="success-message" id="successMessage">
            âœ“ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
        </div>

        <!-- ===== íƒ­ ë²„íŠ¼ ===== -->
        <div class="tab-container">
            <button type="button" class="tab-button active" onclick="switchTab('sangga', this)">
                <span class="tab-icon">ğŸª</span>ìƒê°€
            </button>
            <button type="button" class="tab-button" onclick="switchTab('officetel', this)">
                <span class="tab-icon">ğŸ¢</span>ì˜¤í”¼ìŠ¤í…”
            </button>
            <button type="button" class="tab-button" onclick="switchTab('keylog', this)">
                <span class="tab-icon">ğŸ”‘</span>í‚¤ë¶ˆì¶œëŒ€ì¥
            </button>
            <button type="button" class="tab-button" onclick="switchTab('toolrental', this)">
                <span class="tab-icon">ğŸ”§</span>ê³µê¸°êµ¬ëŒ€ì—¬
            </button>
        </div>

        <!-- ============================================ -->
        <!-- ===== íƒ­ 1: ìƒê°€ ì…ì£¼ìì¹´ë“œ ===== -->
        <!-- ============================================ -->
        <div id="tab-sangga" class="tab-content active">
            <div class="notice-box">
                ğŸ“‹ ë³¸ ì¹´ë“œì— ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ ìš°ë¦¬ë‹¨ì§€ ê´€ë¦¬ì—…ë¬´ì—ë§Œ ì‚¬ìš©ë˜ë©° ì •ë³´í†µì‹ ë§ë³´í˜¸ë²•ì— ì˜ê±° ì™¸ë¶€ì— ìœ ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ê² ìœ¼ë©° 
                ì„¸ëŒ€ê°€ ì „ì¶œì‹œì—ëŠ” ì‹ë³„ë¶ˆê°€ëŠ¥í•˜ê²Œ íŒŒê¸°ë¥¼ í•˜ì˜¤ë‹ˆ ì•„ë˜ ì •ë³´ì´ìš© ë™ì˜ì„œì— ì„œëª…ì„ ë‹¹ë¶€ë“œë¦½ë‹ˆë‹¤.
            </div>

            <form id="sanggaForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ“Œ ê¸°ë³¸ ì •ë³´</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_unitNumber">í˜¸ìˆ˜<span class="required">*</span></label>
                            <input type="text" id="sg_unitNumber" placeholder="ì˜ˆ: 101í˜¸" required>
                        </div>
                        <div class="form-group">
                            <label for="sg_companyName">ì—…ì²´ëª…<span class="required">*</span></label>
                            <input type="text" id="sg_companyName" placeholder="ì—…ì²´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì‚¬ìš©êµ¬ë¶„<span class="required">*</span></label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="sg_usageType" value="ì†Œìœ " required> ì†Œìœ </label>
                                <label><input type="radio" name="sg_usageType" value="ì„ì°¨"> ì„ì°¨</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sg_employeeCount">ì§ì›ìˆ˜</label>
                            <input type="number" id="sg_employeeCount" placeholder="ì§ì› ìˆ˜">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_moveInDate">ì…ì£¼ì¼<span class="required">*</span></label>
                            <input type="date" id="sg_moveInDate" required>
                        </div>
                        <div class="form-group">
                            <label for="sg_moveOutDate">ì „ì¶œì¼</label>
                            <input type="date" id="sg_moveOutDate">
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì—…ì ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸª ì‚¬ì—…ì ì •ë³´</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_businessNumber">ì‚¬ì—…ìë²ˆí˜¸<span class="required">*</span></label>
                            <input type="text" id="sg_businessNumber" placeholder="000-00-00000" required>
                        </div>
                        <div class="form-group">
                            <label for="sg_businessName">ìƒí˜¸<span class="required">*</span></label>
                            <input type="text" id="sg_businessName" placeholder="ìƒí˜¸ëª…" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_representative">ëŒ€í‘œì<span class="required">*</span></label>
                            <input type="text" id="sg_representative" placeholder="ëŒ€í‘œì ì„±ëª…" required>
                        </div>
                        <div class="form-group">
                            <label for="sg_businessCategory">ì—…íƒœ / ì¢…ëª©<span class="required">*</span></label>
                            <input type="text" id="sg_businessCategory" placeholder="ì˜ˆ: ë„ì†Œë§¤ì—… / ìŒì‹ì " required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_businessPhone">ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="sg_businessPhone" placeholder="02-0000-0000">
                        </div>
                        <div class="form-group">
                            <label for="sg_faxNumber">íŒ©ìŠ¤ë²ˆí˜¸</label>
                            <input type="tel" id="sg_faxNumber" placeholder="02-0000-0000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_businessEmail">ì´ë©”ì¼</label>
                            <input type="email" id="sg_businessEmail" placeholder="example@email.com">
                        </div>
                        <div class="form-group">
                            <label for="sg_manager">ë‹´ë‹¹ì</label>
                            <input type="text" id="sg_manager" placeholder="ë‹´ë‹¹ì ì´ë¦„">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sg_managerPhone">ë‹´ë‹¹ìí•¸ë“œí°</label>
                            <input type="tel" id="sg_managerPhone" placeholder="010-0000-0000">
                        </div>
                        <div class="form-group">
                            <label>TVë³´ìœ í˜„í™©</label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="sg_hasTv" value="ìœ "> ìœ </label>
                                <label><input type="radio" name="sg_hasTv" value="ë¬´"> ë¬´</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì„¸ê¸ˆê³„ì‚°ì„œ</label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="sg_taxInvoice" value="ìœ "> ìœ </label>
                                <label><input type="radio" name="sg_taxInvoice" value="ë¬´"> ë¬´</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì§ì› ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ‘¥ ì§ì› ì •ë³´</div>
                    <div class="employee-list" id="sg_employeeList">
                        <div class="employee-item">
                            <h4>ì§ì› 1</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ì„±ëª…</label>
                                    <input type="text" name="sg_employeeName[]" placeholder="ì§ì› ì´ë¦„">
                                </div>
                                <div class="form-group">
                                    <label>ìƒë…„ì›”ì¼</label>
                                    <input type="date" name="sg_employeeBirth[]">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>í•¸ë“œí°</label>
                                    <input type="tel" name="sg_employeePhone[]" placeholder="010-0000-0000">
                                </div>
                                <div class="form-group">
                                    <label>ë¹„ê³ </label>
                                    <input type="text" name="sg_employeeNote[]" placeholder="ë¹„ê³  ì‚¬í•­">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add-employee" onclick="addSgEmployee()">+ ì§ì› ì¶”ê°€</button>
                </div>

                <!-- ì†Œìœ ì ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ  ì†Œìœ ì ì •ë³´</div>
                    <div class="owner-info">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerBusinessName">ìƒí˜¸</label>
                                <input type="text" id="sg_ownerBusinessName" placeholder="ì†Œìœ ì ìƒí˜¸">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownerBusinessNumber">ì‚¬ì—…ìë²ˆí˜¸</label>
                                <input type="text" id="sg_ownerBusinessNumber" placeholder="000-00-00000">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerRepresentative">ëŒ€í‘œì</label>
                                <input type="text" id="sg_ownerRepresentative" placeholder="ì†Œìœ ì ëŒ€í‘œìëª…">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownerBirthDate">ìƒë…„ì›”ì¼</label>
                                <input type="date" id="sg_ownerBirthDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerBusinessType">ì—…íƒœ</label>
                                <input type="text" id="sg_ownerBusinessType" placeholder="ì—…íƒœ">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownerBusinessItem">ì¢…ëª©</label>
                                <input type="text" id="sg_ownerBusinessItem" placeholder="ì¢…ëª©">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerPhone">ì „í™”ë²ˆí˜¸</label>
                                <input type="tel" id="sg_ownerPhone" placeholder="02-0000-0000">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownerFax">íŒ©ìŠ¤ë²ˆí˜¸</label>
                                <input type="tel" id="sg_ownerFax" placeholder="02-0000-0000">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerEmail">ì´ë©”ì¼</label>
                                <input type="email" id="sg_ownerEmail" placeholder="example@email.com">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownershipDate">ì†Œìœ ì¼</label>
                                <input type="date" id="sg_ownershipDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="sg_ownerAddress">ì£¼ì†Œ</label>
                            <input type="text" id="sg_ownerAddress" placeholder="ì†Œìœ ì ì£¼ì†Œ">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sg_ownerManager">ë‹´ë‹¹ì</label>
                                <input type="text" id="sg_ownerManager" placeholder="ë‹´ë‹¹ì ì´ë¦„">
                            </div>
                            <div class="form-group">
                                <label for="sg_ownerManagerPhone">ë‹´ë‹¹ìí•¸ë“œí°</label>
                                <input type="tel" id="sg_ownerManagerPhone" placeholder="010-0000-0000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê°œì¸ì •ë³´ ë™ì˜ -->
                <div class="consent-box">
                    <h3>ğŸ“„ ì…ì£¼ìì¹´ë“œ ì •ë³´ì´ìš© ë™ì˜ì„œ</h3>
                    <p>ë³¸ì¸ì´ ì§ì ‘ ì…ì£¼ìì¹´ë“œì–‘ì‹ì„ ì‘ì„±í•˜ë©° ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³¸ì¸ ë™ì˜ì—†ì´ ì™¸ë¶€ìœ ì¶œ, íƒ€ ìš©ë„ì— ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ì¡°ê±´ìœ¼ë¡œ ê°œì¸ì •ë³´ì·¨ê¸‰ ë° ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©Â·ì œê³µ ë“±ì˜ ë‚´ìš©ì— ëŒ€í•˜ì—¬ ë™ì˜í•©ë‹ˆë‹¤.</p>
                    <div class="consent-checkbox">
                        <label>
                            <input type="checkbox" id="sg_consentCheck" required>
                            <strong>ìœ„ ë‚´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤ (í•„ìˆ˜)</strong>
                        </label>
                    </div>
                </div>

                <div class="contact-info">
                    <strong>ê°œì¸ì •ë³´ê´€ë¦¬ì±…ì„ì:</strong> ì¹´ë¦¼ì• ë¹„ë‰´ ì„¼í„°ì¥ | 
                    <strong>ê´€ë¦¬ì§€ì›ì„¼í„°:</strong> 031-378-2793 | 
                    <strong>FAX:</strong> 031-378-2794 | 
                    <strong>Email:</strong> karim2793@naver.com<br>
                    <strong>ì£¼ì†Œ:</strong> ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ëŒ€ë¡œ 134 ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„° | 
                    <strong>ê´€ë¦¬íšŒì‚¬:</strong> í•œë¹›ì¢…í•©ê´€ë¦¬ãˆœ
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-save">ğŸ’¾ Excel ì €ì¥</button>
                    <button type="button" class="btn-pdf" onclick="saveSanggaPDF()">ğŸ“„ PDF ì €ì¥</button>
                    <button type="reset" class="btn-reset">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <!-- ============================================ -->
        <!-- ===== íƒ­ 2: ì˜¤í”¼ìŠ¤í…” ì…ì£¼ìì¹´ë“œ ===== -->
        <!-- ============================================ -->
        <div id="tab-officetel" class="tab-content">
            <div class="notice-box">
                ğŸ“‹ ë³¸ ì¹´ë“œì— ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ ìš°ë¦¬ë‹¨ì§€ ê´€ë¦¬ì—…ë¬´ì—ë§Œ ì‚¬ìš©ë˜ë©° ì •ë³´í†µì‹ ë§ë³´í˜¸ë²•ì— ì˜ê±° ì™¸ë¶€ì— ìœ ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ê² ìœ¼ë©° 
                ì„¸ëŒ€ê°€ ì „ì¶œì‹œì—ëŠ” ì‹ë³„ë¶ˆê°€ëŠ¥í•˜ê²Œ íŒŒê¸°ë¥¼ í•˜ì˜¤ë‹ˆ ì•„ë˜ ì •ë³´ì´ìš© ë™ì˜ì„œì— ì„œëª…ì„ ë‹¹ë¶€ë“œë¦½ë‹ˆë‹¤.
            </div>

            <form id="officetelForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ“Œ ê¸°ë³¸ ì •ë³´</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ot_unitNumber">í˜¸ìˆ˜<span class="required">*</span></label>
                            <input type="text" id="ot_unitNumber" placeholder="ì˜ˆ: 101í˜¸" required>
                        </div>
                        <div class="form-group">
                            <label for="ot_residentName">ì„±ëª…<span class="required">*</span></label>
                            <input type="text" id="ot_residentName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ot_moveInDate">ì…ì£¼ì¼<span class="required">*</span></label>
                            <input type="date" id="ot_moveInDate" required>
                        </div>
                        <div class="form-group">
                            <label for="ot_moveOutDate">ì „ì¶œì¼</label>
                            <input type="date" id="ot_moveOutDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ì…ì£¼í˜•íƒœ<span class="required">*</span></label>
                        <div class="checkbox-group">
                            <label><input type="radio" name="ot_moveInType" value="ì†Œìœ " required> ì†Œìœ </label>
                            <label><input type="radio" name="ot_moveInType" value="ìê°€"> ìê°€</label>
                            <label><input type="radio" name="ot_moveInType" value="ì „ì„¸"> ì „ì„¸</label>
                            <label><input type="radio" name="ot_moveInType" value="ì›”ì„¸"> ì›”ì„¸</label>
                            <label><input type="radio" name="ot_moveInType" value="ê¸°íƒ€"> ê¸°íƒ€</label>
                        </div>
                    </div>
                </div>

                <!-- ì¸ì ì‚¬í•­ -->
                <div class="section">
                    <div class="section-title">ğŸ‘¤ ì¸ì ì‚¬í•­</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ot_birthDate">ìƒë…„ì›”ì¼</label>
                            <input type="date" id="ot_birthDate">
                        </div>
                        <div class="form-group">
                            <label for="ot_businessName">ìƒí˜¸</label>
                            <input type="text" id="ot_businessName" placeholder="ìƒí˜¸ëª…">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ot_phoneNumber">ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="ot_phoneNumber" placeholder="02-0000-0000">
                        </div>
                        <div class="form-group">
                            <label for="ot_businessNumber">ì‚¬ì—…ìë²ˆí˜¸</label>
                            <input type="text" id="ot_businessNumber" placeholder="000-00-00000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ot_mobilePhone">í•¸ë“œí°</label>
                            <input type="tel" id="ot_mobilePhone" placeholder="010-0000-0000">
                        </div>
                        <div class="form-group">
                            <label for="ot_email">ì´ë©”ì¼</label>
                            <input type="email" id="ot_email" placeholder="example@email.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>TVë³´ìœ í˜„í™©</label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="ot_hasTv" value="ìœ "> ìœ </label>
                                <label><input type="radio" name="ot_hasTv" value="ë¬´"> ë¬´</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ì„¸ê¸ˆê³„ì‚°ì„œ</label>
                            <div class="checkbox-group">
                                <label><input type="radio" name="ot_taxInvoice" value="ìœ "> ìœ </label>
                                <label><input type="radio" name="ot_taxInvoice" value="ë¬´"> ë¬´</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê°€ì¡±/ì§ì› ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ‘¥ ê°€ì¡±/ì§ì› ì •ë³´</div>
                    <div class="employee-list" id="ot_familyList">
                        <div class="employee-item">
                            <h4>ê°€ì¡±/ì§ì› 1</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ì„±ëª…</label>
                                    <input type="text" name="ot_familyName[]" placeholder="ì´ë¦„">
                                </div>
                                <div class="form-group">
                                    <label>ìƒë…„ì›”ì¼</label>
                                    <input type="date" name="ot_familyBirth[]">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>í•¸ë“œí°</label>
                                    <input type="tel" name="ot_familyPhone[]" placeholder="010-0000-0000">
                                </div>
                                <div class="form-group">
                                    <label>ë¹„ê³ </label>
                                    <input type="text" name="ot_familyNote[]" placeholder="ë¹„ê³  ì‚¬í•­">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add-employee" onclick="addOtFamily()">+ ê°€ì¡±/ì§ì› ì¶”ê°€</button>
                </div>

                <!-- ì†Œìœ ì ì •ë³´ -->
                <div class="section">
                    <div class="section-title">ğŸ  ì†Œìœ ì ì •ë³´</div>
                    <div class="owner-info">
                        <div class="form-row-3">
                            <div class="form-group">
                                <label for="ot_ownerBusinessName">ìƒí˜¸</label>
                                <input type="text" id="ot_ownerBusinessName" placeholder="ì†Œìœ ì ìƒí˜¸">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownerBusinessNumber">ì‚¬ì—…ìë²ˆí˜¸</label>
                                <input type="text" id="ot_ownerBusinessNumber" placeholder="000-00-00000">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownershipDate">ì†Œìœ ì¼</label>
                                <input type="date" id="ot_ownershipDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ot_ownerRepresentative">ëŒ€í‘œì</label>
                                <input type="text" id="ot_ownerRepresentative" placeholder="ì†Œìœ ì ëŒ€í‘œìëª…">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownerBirthDate">ìƒë…„ì›”ì¼</label>
                                <input type="date" id="ot_ownerBirthDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ot_ownerBusinessType">ì—…íƒœ</label>
                                <input type="text" id="ot_ownerBusinessType" placeholder="ì—…íƒœ">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownerBusinessItem">ì¢…ëª©</label>
                                <input type="text" id="ot_ownerBusinessItem" placeholder="ì¢…ëª©">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ot_ownerPhone">ì „í™”ë²ˆí˜¸</label>
                                <input type="tel" id="ot_ownerPhone" placeholder="02-0000-0000">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownerFax">íŒ©ìŠ¤ë²ˆí˜¸</label>
                                <input type="tel" id="ot_ownerFax" placeholder="02-0000-0000">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ot_ownerEmail">ì´ë©”ì¼</label>
                            <input type="email" id="ot_ownerEmail" placeholder="example@email.com">
                        </div>
                        <div class="form-group">
                            <label for="ot_ownerAddress">ì£¼ì†Œ</label>
                            <input type="text" id="ot_ownerAddress" placeholder="ì†Œìœ ì ì£¼ì†Œ">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ot_ownerManager">ë‹´ë‹¹ì</label>
                                <input type="text" id="ot_ownerManager" placeholder="ë‹´ë‹¹ì ì´ë¦„">
                            </div>
                            <div class="form-group">
                                <label for="ot_ownerManagerPhone">ë‹´ë‹¹ìí•¸ë“œí°</label>
                                <input type="tel" id="ot_ownerManagerPhone" placeholder="010-0000-0000">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ê°œì¸ì •ë³´ ë™ì˜ -->
                <div class="consent-box">
                    <h3>ğŸ“„ ì…ì£¼ìì¹´ë“œ ì •ë³´ì´ìš© ë™ì˜ì„œ</h3>
                    <p>ë³¸ì¸ì´ ì§ì ‘ ì…ì£¼ìì¹´ë“œì–‘ì‹ì„ ì‘ì„±í•˜ë©° ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³¸ì¸ ë™ì˜ì—†ì´ ì™¸ë¶€ìœ ì¶œ, íƒ€ ìš©ë„ì— ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ì¡°ê±´ìœ¼ë¡œ ê°œì¸ì •ë³´ì·¨ê¸‰ ë° ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©Â·ì œê³µ ë“±ì˜ ë‚´ìš©ì— ëŒ€í•˜ì—¬ ë™ì˜í•©ë‹ˆë‹¤.</p>
                    <div class="consent-checkbox">
                        <label>
                            <input type="checkbox" id="ot_consentCheck" required>
                            <strong>ìœ„ ë‚´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤ (í•„ìˆ˜)</strong>
                        </label>
                    </div>
                </div>

                <div class="contact-info">
                    <strong>ê°œì¸ì •ë³´ê´€ë¦¬ì±…ì„ì:</strong> ì¹´ë¦¼ì• ë¹„ë‰´ ì„¼í„°ì¥ | 
                    <strong>ê´€ë¦¬ì§€ì›ì„¼í„°:</strong> 031-378-2793 | 
                    <strong>FAX:</strong> 031-378-2794 | 
                    <strong>Email:</strong> karim2793@naver.com<br>
                    <strong>ì£¼ì†Œ:</strong> ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ëŒ€ë¡œ 134 ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„° | 
                    <strong>ê´€ë¦¬íšŒì‚¬:</strong> í•œë¹›ì¢…í•©ê´€ë¦¬ãˆœ
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-save">ğŸ’¾ Excel ì €ì¥</button>
                    <button type="button" class="btn-pdf" onclick="saveOfficetelPDF()">ğŸ“„ PDF ì €ì¥</button>
                    <button type="reset" class="btn-reset">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
            </form>
        </div>

        <!-- ============================================ -->
        <!-- ===== íƒ­ 3: í‚¤ë¶ˆì¶œëŒ€ì¥ ===== -->
        <!-- ============================================ -->
        <div id="tab-keylog" class="tab-content">
            <div class="ledger-title">ğŸ”‘ í‚¤ë¶„ì¶œëŒ€ì¥</div>
            <div class="ledger-subtitle">ë‹¹ì¼ë¶ˆì¶œìš©</div>

            <div class="notice-box">
                ğŸ“‹ í‚¤ ë¶ˆì¶œ ì‹œ ì•„ë˜ ì–‘ì‹ì„ ì‘ì„±í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ë°˜ë‚© ì‹œ ë°˜ë“œì‹œ ë°˜ë‚©ì‹œê°„ì„ ê¸°ì¬í•´ ì£¼ì„¸ìš”.
            </div>

            <div class="section key-section" style="border-left-color: #e67e22;">
                <div class="section-title" style="color: #e67e22;">ğŸ”‘ í‚¤ ë¶ˆì¶œ ê¸°ë¡</div>

                <div class="ledger-table-wrapper">
                    <table class="ledger-table" id="keyLogTable">
                        <thead>
                            <tr>
                                <th style="width:40px;">No.</th>
                                <th style="width:130px;">ì¼ì<br><span style="font-size:11px;font-weight:400;">(ë…„/ì›”/ì¼)</span></th>
                                <th style="width:80px;">ì‹œê°„</th>
                                <th style="width:100px;">ì´ë¦„</th>
                                <th style="width:130px;">ì—°ë½ì²˜</th>
                                <th style="width:80px;">í˜¸ìˆ˜</th>
                                <th>ë¶ˆì¶œ ì‚¬ìœ <br><span style="font-size:11px;font-weight:400;">(ì˜ˆ: 000í˜¸ ê³µì‚¬)</span></th>
                                <th style="width:80px;">ë°˜ë‚© ì‹œê°„</th>
                                <th style="width:50px;">ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody id="keyLogBody">
                            <tr>
                                <td class="row-number">1</td>
                                <td><input type="date" name="kl_date[]"></td>
                                <td><input type="time" name="kl_time[]"></td>
                                <td><input type="text" name="kl_name[]" placeholder="ì´ë¦„"></td>
                                <td><input type="tel" name="kl_contact[]" placeholder="010-0000-0000"></td>
                                <td><input type="text" name="kl_unit[]" placeholder="í˜¸ìˆ˜"></td>
                                <td><input type="text" name="kl_reason[]" placeholder="ë¶ˆì¶œ ì‚¬ìœ "></td>
                                <td><input type="time" name="kl_returnTime[]"></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="ledger-actions">
                    <button type="button" class="btn-add-row" onclick="addKeyLogRow()">+ í–‰ ì¶”ê°€</button>
                </div>
            </div>

            <div class="contact-info">
                <strong>ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°</strong> | 
                <strong>TEL:</strong> 031-378-2793 | 
                <strong>FAX:</strong> 031-378-2794 | 
                <strong>Email:</strong> karim2793@naver.com
            </div>

            <div class="button-group">
                <button type="button" class="btn-save" onclick="saveKeyLogExcel()">ğŸ’¾ Excel ì €ì¥</button>
                <button type="button" class="btn-pdf" onclick="saveKeyLogPDF()">ğŸ“„ PDF ì €ì¥</button>
                <button type="button" class="btn-reset" onclick="resetKeyLog()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ===== íƒ­ 4: ê³µê¸°êµ¬ëŒ€ì—¬ ê´€ë¦¬ëŒ€ì¥ ===== -->
        <!-- ============================================ -->
        <div id="tab-toolrental" class="tab-content">
            <div class="ledger-title">ğŸ”§ ê³µê¸°êµ¬ ëŒ€ì—¬ ê´€ë¦¬ ëŒ€ì¥</div>
            <div class="ledger-subtitle">ê³µê¸°êµ¬ ëŒ€ì—¬ ë° ë°˜ë‚© ê´€ë¦¬</div>

            <div class="notice-box">
                ğŸ“‹ ê³µê¸°êµ¬ ëŒ€ì—¬ ì‹œ ì•„ë˜ ì–‘ì‹ì„ ì‘ì„±í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ë°˜ë‚© ì‹œ ë°˜ë‚©ì‹œê°„ ê¸°ì¬ ë° í™•ì¸ì„œëª…ì„ í•´ì£¼ì„¸ìš”.
            </div>

            <div class="section tool-section" style="border-left-color: #27ae60;">
                <div class="section-title" style="color: #27ae60;">ğŸ”§ ê³µê¸°êµ¬ ëŒ€ì—¬ ê¸°ë¡</div>

                <div class="ledger-table-wrapper">
                    <table class="ledger-table" id="toolRentalTable">
                        <thead>
                            <tr>
                                <th style="width:40px;">No.</th>
                                <th style="width:130px;">ì¼ì<br><span style="font-size:11px;font-weight:400;">(ë…„/ì›”/ì¼)</span></th>
                                <th style="width:100px;">í˜¸ì‹¤ / ìƒí˜¸</th>
                                <th style="width:100px;">ì´ë¦„</th>
                                <th style="width:130px;">ì—°ë½ì²˜</th>
                                <th>ëŒ€ì—¬ ê³µêµ¬ ëª…</th>
                                <th style="width:80px;">ë°˜ë‚©ì‹œê°„</th>
                                <th style="width:100px;">í™•ì¸ì„œëª…</th>
                                <th style="width:50px;">ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody id="toolRentalBody">
                            <tr>
                                <td class="row-number">1</td>
                                <td><input type="date" name="tr_date[]"></td>
                                <td><input type="text" name="tr_unit[]" placeholder="í˜¸ì‹¤/ìƒí˜¸"></td>
                                <td><input type="text" name="tr_name[]" placeholder="ì´ë¦„"></td>
                                <td><input type="tel" name="tr_contact[]" placeholder="010-0000-0000"></td>
                                <td><input type="text" name="tr_tool[]" placeholder="ëŒ€ì—¬ ê³µêµ¬ ëª…"></td>
                                <td><input type="time" name="tr_returnTime[]"></td>
                                <td><input type="text" name="tr_signature[]" placeholder="ì„œëª…"></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="ledger-actions">
                    <button type="button" class="btn-add-row" onclick="addToolRentalRow()">+ í–‰ ì¶”ê°€</button>
                </div>
            </div>

            <div class="contact-info">
                <strong>ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°</strong> | 
                <strong>TEL:</strong> 031-378-2793 | 
                <strong>FAX:</strong> 031-378-2794 | 
                <strong>Email:</strong> karim2793@naver.com
            </div>

            <div class="button-group">
                <button type="button" class="btn-save" onclick="saveToolRentalExcel()">ğŸ’¾ Excel ì €ì¥</button>
                <button type="button" class="btn-pdf" onclick="saveToolRentalPDF()">ğŸ“„ PDF ì €ì¥</button>
                <button type="button" class="btn-reset" onclick="resetToolRental()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
        </div>
    </div>

    <script>
        // ===== íƒ­ ì „í™˜ =====
        function switchTab(tabName, btn) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-' + tabName).classList.add('active');
            btn.classList.add('active');
        }

        // ===== ê³µí†µ PDF ìƒì„± í•¨ìˆ˜ =====
        function generatePDF(containerSelector, fileName, consentId) {
            if (consentId && !document.getElementById(consentId).checked) {
                alert('ê°œì¸ì •ë³´ ì´ìš© ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const activeTab = document.querySelector('.tab-content.active');
            const buttons = activeTab.querySelector('.button-group');
            const successMessage = document.getElementById('successMessage');
            const tabContainer = document.querySelector('.tab-container');
            const inactiveTabs = document.querySelectorAll('.tab-content:not(.active)');
            
            const origBtnDisplay = buttons.style.display;
            const origMsgDisplay = successMessage.style.display;
            const origTabDisplay = tabContainer.style.display;
            
            buttons.style.display = 'none';
            successMessage.style.display = 'none';
            tabContainer.style.display = 'none';
            inactiveTabs.forEach(t => t.style.display = 'none');

            // ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const deleteButtons = activeTab.querySelectorAll('.btn-remove-row');
            deleteButtons.forEach(b => b.style.display = 'none');
            const addButtons = activeTab.querySelectorAll('.btn-add-row');
            addButtons.forEach(b => b.style.display = 'none');
            // ì‚­ì œ ì—´ ìˆ¨ê¸°ê¸°
            const deleteThs = activeTab.querySelectorAll('th:last-child');
            const deleteTds = activeTab.querySelectorAll('tbody td:last-child');

            setTimeout(() => {
                const container = document.querySelector('.container');
                
                html2canvas(container, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: false,
                    logging: false,
                    backgroundColor: '#ffffff',
                    onclone: function(clonedDoc) {
                        const clonedButtons = clonedDoc.querySelector('.tab-content.active .button-group');
                        const clonedMessage = clonedDoc.querySelector('#successMessage');
                        const clonedTabs = clonedDoc.querySelector('.tab-container');
                        const clonedInactive = clonedDoc.querySelectorAll('.tab-content:not(.active)');
                        if (clonedButtons) clonedButtons.style.display = 'none';
                        if (clonedMessage) clonedMessage.style.display = 'none';
                        if (clonedTabs) clonedTabs.style.display = 'none';
                        clonedInactive.forEach(t => t.style.display = 'none');
                        // ì‚­ì œ ë²„íŠ¼/í–‰ì¶”ê°€ ìˆ¨ê¹€
                        clonedDoc.querySelectorAll('.btn-remove-row, .btn-add-row, .ledger-actions').forEach(el => el.style.display = 'none');
                    }
                }).then(canvas => {
                    buttons.style.display = origBtnDisplay;
                    successMessage.style.display = origMsgDisplay;
                    tabContainer.style.display = '';
                    inactiveTabs.forEach(t => t.style.display = '');
                    deleteButtons.forEach(b => b.style.display = '');
                    addButtons.forEach(b => b.style.display = '');

                    try {
                        const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                        const imgWidth = 210;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        const imgData = canvas.toDataURL('image/png', 1.0);

                        let heightLeft = imgHeight;
                        let position = 0;
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= 297;

                        while (heightLeft > 0) {
                            position = heightLeft - imgHeight;
                            pdf.addPage();
                            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                            heightLeft -= 297;
                        }

                        pdf.save(fileName);
                        showSuccess('âœ“ PDF íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } catch (error) {
                        console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                        showError('âŒ PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }).catch(error => {
                    buttons.style.display = origBtnDisplay;
                    successMessage.style.display = origMsgDisplay;
                    tabContainer.style.display = '';
                    inactiveTabs.forEach(t => t.style.display = '');
                    deleteButtons.forEach(b => b.style.display = '');
                    addButtons.forEach(b => b.style.display = '');
                    console.error('ìº¡ì²˜ ì˜¤ë¥˜:', error);
                    alert('í™”ë©´ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    showError('âŒ í™”ë©´ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
            }, 300);
        }

        function showSuccess(msg) {
            const el = document.getElementById('successMessage');
            el.textContent = msg;
            el.style.background = '#d4edda'; el.style.color = '#155724'; el.style.borderColor = '#c3e6cb';
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function showError(msg) {
            const el = document.getElementById('successMessage');
            el.textContent = msg;
            el.style.background = '#f8d7da'; el.style.color = '#721c24'; el.style.borderColor = '#f5c6cb';
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // ===== ìƒê°€ PDF ì €ì¥ =====
        function saveSanggaPDF() {
            const unit = document.getElementById('sg_unitNumber').value;
            const biz = document.getElementById('sg_businessName').value;
            if (!unit || !biz) { alert('í˜¸ìˆ˜ì™€ ìƒí˜¸ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.'); return; }
            generatePDF('.container', `${unit}_${biz}_ìƒê°€_ì…ì£¼ìì¹´ë“œ.pdf`, 'sg_consentCheck');
        }

        // ===== ì˜¤í”¼ìŠ¤í…” PDF ì €ì¥ =====
        function saveOfficetelPDF() {
            const unit = document.getElementById('ot_unitNumber').value;
            const name = document.getElementById('ot_residentName').value;
            if (!unit || !name) { alert('í˜¸ìˆ˜ì™€ ì„±ëª…ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.'); return; }
            generatePDF('.container', `${unit}_${name}_ì˜¤í”¼ìŠ¤í…”_ì…ì£¼ìì¹´ë“œ.pdf`, 'ot_consentCheck');
        }

        // ===== ìƒê°€ ì§ì› ì¶”ê°€/ì‚­ì œ =====
        let sgEmployeeCount = 1;
        function addSgEmployee() {
            sgEmployeeCount++;
            const list = document.getElementById('sg_employeeList');
            const item = document.createElement('div');
            item.className = 'employee-item';
            item.innerHTML = `
                <h4>ì§ì› ${sgEmployeeCount}</h4>
                <button type="button" class="btn-remove-employee" onclick="this.parentElement.remove()">ì‚­ì œ</button>
                <div class="form-row">
                    <div class="form-group"><label>ì„±ëª…</label><input type="text" name="sg_employeeName[]" placeholder="ì§ì› ì´ë¦„"></div>
                    <div class="form-group"><label>ìƒë…„ì›”ì¼</label><input type="date" name="sg_employeeBirth[]"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>í•¸ë“œí°</label><input type="tel" name="sg_employeePhone[]" placeholder="010-0000-0000"></div>
                    <div class="form-group"><label>ë¹„ê³ </label><input type="text" name="sg_employeeNote[]" placeholder="ë¹„ê³  ì‚¬í•­"></div>
                </div>`;
            list.appendChild(item);
            item.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
        }

        // ===== ì˜¤í”¼ìŠ¤í…” ê°€ì¡±/ì§ì› ì¶”ê°€/ì‚­ì œ =====
        let otFamilyCount = 1;
        function addOtFamily() {
            otFamilyCount++;
            const list = document.getElementById('ot_familyList');
            const item = document.createElement('div');
            item.className = 'employee-item';
            item.innerHTML = `
                <h4>ê°€ì¡±/ì§ì› ${otFamilyCount}</h4>
                <button type="button" class="btn-remove-employee" onclick="this.parentElement.remove()">ì‚­ì œ</button>
                <div class="form-row">
                    <div class="form-group"><label>ì„±ëª…</label><input type="text" name="ot_familyName[]" placeholder="ì´ë¦„"></div>
                    <div class="form-group"><label>ìƒë…„ì›”ì¼</label><input type="date" name="ot_familyBirth[]"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>í•¸ë“œí°</label><input type="tel" name="ot_familyPhone[]" placeholder="010-0000-0000"></div>
                    <div class="form-group"><label>ë¹„ê³ </label><input type="text" name="ot_familyNote[]" placeholder="ë¹„ê³  ì‚¬í•­"></div>
                </div>`;
            list.appendChild(item);
            item.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
        }

        // ===== ìƒê°€ í¼ ì œì¶œ =====
        document.getElementById('sanggaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!document.getElementById('sg_consentCheck').checked) { alert('ê°œì¸ì •ë³´ ì´ìš© ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
            createSanggaExcel();
        });

        function createSanggaExcel() {
            const d = {
                unitNumber: document.getElementById('sg_unitNumber').value,
                companyName: document.getElementById('sg_companyName').value,
                usageType: document.querySelector('input[name="sg_usageType"]:checked')?.value || '',
                employeeCount: document.getElementById('sg_employeeCount').value,
                moveInDate: document.getElementById('sg_moveInDate').value,
                moveOutDate: document.getElementById('sg_moveOutDate').value,
                businessNumber: document.getElementById('sg_businessNumber').value,
                businessName: document.getElementById('sg_businessName').value,
                representative: document.getElementById('sg_representative').value,
                businessCategory: document.getElementById('sg_businessCategory').value,
                businessPhone: document.getElementById('sg_businessPhone').value,
                faxNumber: document.getElementById('sg_faxNumber').value,
                businessEmail: document.getElementById('sg_businessEmail').value,
                manager: document.getElementById('sg_manager').value,
                managerPhone: document.getElementById('sg_managerPhone').value,
                hasTv: document.querySelector('input[name="sg_hasTv"]:checked')?.value || '',
                taxInvoice: document.querySelector('input[name="sg_taxInvoice"]:checked')?.value || '',
                empNames: Array.from(document.querySelectorAll('input[name="sg_employeeName[]"]')).map(el => el.value),
                empBirths: Array.from(document.querySelectorAll('input[name="sg_employeeBirth[]"]')).map(el => el.value),
                empPhones: Array.from(document.querySelectorAll('input[name="sg_employeePhone[]"]')).map(el => el.value),
                empNotes: Array.from(document.querySelectorAll('input[name="sg_employeeNote[]"]')).map(el => el.value),
                ownerBizName: document.getElementById('sg_ownerBusinessName').value,
                ownerBizNum: document.getElementById('sg_ownerBusinessNumber').value,
                ownerRep: document.getElementById('sg_ownerRepresentative').value,
                ownerBirth: document.getElementById('sg_ownerBirthDate').value,
                ownerBizType: document.getElementById('sg_ownerBusinessType').value,
                ownerBizItem: document.getElementById('sg_ownerBusinessItem').value,
                ownerPhone: document.getElementById('sg_ownerPhone').value,
                ownerFax: document.getElementById('sg_ownerFax').value,
                ownerEmail: document.getElementById('sg_ownerEmail').value,
                ownershipDate: document.getElementById('sg_ownershipDate').value,
                ownerAddress: document.getElementById('sg_ownerAddress').value,
                ownerManager: document.getElementById('sg_ownerManager').value,
                ownerManagerPhone: document.getElementById('sg_ownerManagerPhone').value
            };

            const wb = XLSX.utils.book_new();
            const ws = [];
            for (let i = 0; i < 35; i++) ws.push(new Array(25).fill(null));

            ws[0][0] = '    ìƒê°€ ì…ì£¼ìì¹´ë“œ';
            ws[2][0] = 'í˜¸ìˆ˜'; ws[2][4] = d.unitNumber; ws[2][11] = 'ì…ì£¼ì¼'; ws[2][14] = d.moveInDate;
            ws[3][0] = 'ì—…ì²´ëª…'; ws[3][4] = d.companyName; ws[3][11] = 'ì „ì¶œì¼'; ws[3][14] = d.moveOutDate;
            ws[4][0] = 'ì‚¬ìš©êµ¬ë¶„'; ws[4][4] = `      ${d.usageType==='ì†Œìœ '?'â˜‘':'â–¡'} ì†Œìœ            ${d.usageType==='ì„ì°¨'?'â˜‘':'â–¡'} ì„ì°¨`; ws[4][11] = 'ì§ì›ìˆ˜'; ws[4][14] = d.employeeCount;
            ws[6][0] = 'ì‚¬ ì—… ì'; ws[6][1] = 'ì‚¬ì—…ìë²ˆí˜¸'; ws[6][4] = d.businessNumber; ws[6][11] = 'ìƒí˜¸'; ws[6][14] = d.businessName;
            ws[7][1] = 'ëŒ€í‘œì'; ws[7][4] = d.representative; ws[7][11] = 'ì—…íƒœ / ì¢…ëª©'; ws[7][14] = d.businessCategory;
            ws[8][1] = 'ì´ë©”ì¼'; ws[8][4] = d.businessEmail;
            ws[9][1] = 'ì „í™”ë²ˆí˜¸'; ws[9][4] = d.businessPhone; ws[9][11] = 'íŒ©ìŠ¤ë²ˆí˜¸'; ws[9][14] = d.faxNumber;
            ws[10][1] = 'ë‹´ë‹¹ì'; ws[10][4] = d.manager; ws[10][11] = 'ë‹´ë‹¹ìí•¸ë“œí°'; ws[10][14] = d.managerPhone;
            ws[11][1] = 'TVë³´ìœ í˜„í™©'; ws[11][4] = `${d.hasTv==='ìœ '?'â˜‘':'â–¡'} ìœ    ${d.hasTv==='ë¬´'?'â˜‘':'â–¡'} ë¬´`; ws[11][11] = 'ì„¸ê¸ˆê³„ì‚°ì„œ'; ws[11][14] = `${d.taxInvoice==='ìœ '?'â˜‘':'â–¡'} ìœ    ${d.taxInvoice==='ë¬´'?'â˜‘':'â–¡'} ë¬´`;
            ws[13][0] = 'ì§  ì›'; ws[13][1] = 'ì„±ëª…'; ws[13][4] = 'ìƒ ë…„ ì›” ì¼'; ws[13][9] = 'í•¸ ë“œ í°'; ws[13][14] = 'ë¹„          ê³ ';
            let er = 14;
            for (let i = 0; i < Math.min(d.empNames.length, 6); i++) {
                if (d.empNames[i]||d.empBirths[i]||d.empPhones[i]||d.empNotes[i]) {
                    ws[er][1]=d.empNames[i]||''; ws[er][4]=d.empBirths[i]||''; ws[er][9]=d.empPhones[i]||''; ws[er][14]=d.empNotes[i]||''; er++;
                }
            }
            ws[19][0]='ì†Œ ìœ  ì'; ws[19][1]='ìƒí˜¸'; ws[19][4]=d.ownerBizName; ws[19][8]='ì‚¬ì—…ìë²ˆí˜¸'; ws[19][11]=d.ownerBizNum; ws[19][15]='ì†Œìœ ì¼'; ws[19][18]=d.ownershipDate;
            ws[20][1]='ëŒ€í‘œì'; ws[20][4]=d.ownerRep; ws[20][11]='ìƒë…„ì›”ì¼'; ws[20][14]=d.ownerBirth;
            ws[21][1]='ì—…íƒœ'; ws[21][4]=d.ownerBizType; ws[21][11]='ì¢…ëª©'; ws[21][14]=d.ownerBizItem;
            ws[22][1]='ì „í™”ë²ˆí˜¸'; ws[22][4]=d.ownerPhone; ws[22][11]='íŒ©ìŠ¤ë²ˆí˜¸'; ws[22][14]=d.ownerFax;
            ws[23][1]='ì´ë©”ì¼'; ws[23][4]=d.ownerEmail;
            ws[24][1]='ì£¼ì†Œ'; ws[24][4]=d.ownerAddress;
            ws[25][1]='ë‹´ë‹¹ì'; ws[25][4]=d.ownerManager; ws[25][11]='ë‹´ë‹¹ìí•¸ë“œí°'; ws[25][14]=d.ownerManagerPhone;
            ws[27][0]='â€» ë³¸ ì¹´ë“œì— ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ ìš°ë¦¬ë‹¨ì§€ ê´€ë¦¬ì—…ë¬´ì—ë§Œ ì‚¬ìš©ë˜ë©° ì •ë³´í†µì‹ ë§ë³´í˜¸ë²•ì— ì˜ê±° ì™¸ë¶€ì— ìœ ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ê² ìœ¼ë©° ì„¸ëŒ€ê°€ ì „ì¶œì‹œì—ëŠ” ì‹ë³„ë¶ˆê°€ëŠ¥í•˜ê²Œ íŒŒê¸°ë¥¼ í•˜ì˜¤ë‹ˆ ì•„ë˜ ì •ë³´ì´ìš© ë™ì˜ì„œì— ì„œëª…ì„ ë‹¹ë¶€ë“œë¦½ë‹ˆë‹¤.';
            ws[28][0]='ê°œì¸ì •ë³´ê´€ë¦¬ì±…ì„ì'; ws[28][4]='ê°œì¸ì •ë³´ ë³´í˜¸ì—…ë¬´ ë° ê´€ë ¨\nê³ ì¸µ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ì„œ'; ws[28][9]='ê´€ë¦¬ì§€ì›ì„¼í„° ì „í™”ë²ˆí˜¸'; ws[28][13]='ê´€ë¦¬ì§€ì›ì„¼í„° ì£¼ì†Œ'; ws[28][18]='ê´€ë¦¬íšŒì‚¬ëª…';
            ws[29][0]='ì¹´ë¦¼ì• ë¹„ë‰´ ì„¼í„°ì¥'; ws[29][4]='ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°'; ws[29][9]='031-378-2793'; ws[29][13]='ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ëŒ€ë¡œ 134\nì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°'; ws[29][18]='í•œë¹›ì¢…í•©ê´€ë¦¬ãˆœ';
            ws[30][0]='ì…ì£¼ìì¹´ë“œ ì •ë³´ì´ìš© ë™ì˜ì„œ';
            ws[31][0]='    ë³¸ì¸ ìí•„ë¡œ ì…ì£¼ìì¹´ë“œì–‘ì‹ì„ ì‘ì„±í•˜ë©° ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³¸ì¸ ë™ì˜ì—†ì´ ì™¸ë¶€ìœ ì¶œ, íƒ€ ìš©ë„ì— ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤ëŠ” ì¡°ê±´ìœ¼ë¡œ ê°œì¸ì •ë³´ì·¨ê¸‰ ë° ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘.ì´ìš©.ì œê³µ ë“±ì˜ ë‚´ìš©ì— ëŒ€í•˜ì—¬ ë™ì˜í•©ë‹ˆë‹¤.';
            const now = new Date();
            ws[32][0]=`20${now.getFullYear().toString().slice(-2)}     ë…„      ${now.getMonth()+1}       ì›”       ${now.getDate()}ì¼`;
            ws[32][13]='ì„±    ëª… : '; ws[32][16]=d.representative; ws[32][19]='(ì¸)';
            ws[33][0]='â€» ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°   TEL : 031-378-2793   FAX : 031-378-2794  E-mail : karim2793@naver.com â€»';

            const sheet = XLSX.utils.aoa_to_sheet(ws);
            sheet['!merges'] = [
                {s:{r:0,c:0},e:{r:0,c:24}},{s:{r:2,c:0},e:{r:2,c:3}},{s:{r:2,c:4},e:{r:2,c:10}},{s:{r:2,c:14},e:{r:2,c:20}},
                {s:{r:3,c:0},e:{r:3,c:3}},{s:{r:3,c:4},e:{r:3,c:10}},{s:{r:3,c:14},e:{r:3,c:20}},
                {s:{r:4,c:0},e:{r:4,c:3}},{s:{r:4,c:4},e:{r:4,c:10}},
                {s:{r:6,c:0},e:{r:12,c:0}},{s:{r:6,c:1},e:{r:6,c:3}},{s:{r:6,c:4},e:{r:6,c:10}},{s:{r:6,c:14},e:{r:6,c:20}},
                {s:{r:7,c:1},e:{r:7,c:3}},{s:{r:7,c:4},e:{r:7,c:10}},{s:{r:7,c:14},e:{r:7,c:20}},
                {s:{r:8,c:1},e:{r:8,c:3}},{s:{r:8,c:4},e:{r:8,c:20}},
                {s:{r:9,c:1},e:{r:9,c:3}},{s:{r:9,c:4},e:{r:9,c:10}},{s:{r:9,c:14},e:{r:9,c:20}},
                {s:{r:10,c:1},e:{r:10,c:3}},{s:{r:10,c:4},e:{r:10,c:10}},{s:{r:10,c:14},e:{r:10,c:20}},
                {s:{r:11,c:1},e:{r:11,c:3}},{s:{r:11,c:4},e:{r:11,c:10}},{s:{r:11,c:14},e:{r:11,c:20}},
                {s:{r:13,c:0},e:{r:18,c:0}},{s:{r:13,c:1},e:{r:13,c:3}},{s:{r:13,c:4},e:{r:13,c:8}},{s:{r:13,c:9},e:{r:13,c:13}},{s:{r:13,c:14},e:{r:13,c:20}},
                {s:{r:19,c:0},e:{r:25,c:0}},{s:{r:19,c:1},e:{r:19,c:3}},{s:{r:19,c:4},e:{r:19,c:7}},{s:{r:19,c:11},e:{r:19,c:14}},
                {s:{r:27,c:0},e:{r:27,c:24}},
                {s:{r:28,c:0},e:{r:28,c:3}},{s:{r:28,c:4},e:{r:28,c:8}},{s:{r:28,c:9},e:{r:28,c:12}},{s:{r:28,c:13},e:{r:28,c:17}},{s:{r:28,c:18},e:{r:28,c:24}},
                {s:{r:30,c:0},e:{r:30,c:24}},{s:{r:31,c:0},e:{r:31,c:24}},{s:{r:33,c:0},e:{r:33,c:24}}
            ];
            sheet['!cols'] = Array.from({length:25}, (_,i) => ({wch: i===0?10:8}));
            sheet['!rows'] = Array.from({length:35}, () => ({hpt:20}));
            XLSX.utils.book_append_sheet(wb, sheet, 'ìƒê°€');
            XLSX.writeFile(wb, `${d.unitNumber}_${d.businessName}_ìƒê°€.xlsx`);
            showSuccess('âœ“ Excel íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ===== ì˜¤í”¼ìŠ¤í…” í¼ ì œì¶œ =====
        document.getElementById('officetelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!document.getElementById('ot_consentCheck').checked) { alert('ê°œì¸ì •ë³´ ì´ìš© ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
            createOfficetelExcel();
        });

        function createOfficetelExcel() {
            const d = {
                unitNumber: document.getElementById('ot_unitNumber').value,
                residentName: document.getElementById('ot_residentName').value,
                moveInDate: document.getElementById('ot_moveInDate').value,
                moveOutDate: document.getElementById('ot_moveOutDate').value,
                moveInType: document.querySelector('input[name="ot_moveInType"]:checked')?.value || '',
                birthDate: document.getElementById('ot_birthDate').value,
                businessName: document.getElementById('ot_businessName').value,
                phoneNumber: document.getElementById('ot_phoneNumber').value,
                businessNumber: document.getElementById('ot_businessNumber').value,
                mobilePhone: document.getElementById('ot_mobilePhone').value,
                email: document.getElementById('ot_email').value,
                hasTv: document.querySelector('input[name="ot_hasTv"]:checked')?.value || '',
                taxInvoice: document.querySelector('input[name="ot_taxInvoice"]:checked')?.value || '',
                famNames: Array.from(document.querySelectorAll('input[name="ot_familyName[]"]')).map(el => el.value),
                famBirths: Array.from(document.querySelectorAll('input[name="ot_familyBirth[]"]')).map(el => el.value),
                famPhones: Array.from(document.querySelectorAll('input[name="ot_familyPhone[]"]')).map(el => el.value),
                famNotes: Array.from(document.querySelectorAll('input[name="ot_familyNote[]"]')).map(el => el.value),
                ownerBizName: document.getElementById('ot_ownerBusinessName').value,
                ownerBizNum: document.getElementById('ot_ownerBusinessNumber').value,
                ownershipDate: document.getElementById('ot_ownershipDate').value,
                ownerRep: document.getElementById('ot_ownerRepresentative').value,
                ownerBirth: document.getElementById('ot_ownerBirthDate').value,
                ownerBizType: document.getElementById('ot_ownerBusinessType').value,
                ownerBizItem: document.getElementById('ot_ownerBusinessItem').value,
                ownerPhone: document.getElementById('ot_ownerPhone').value,
                ownerFax: document.getElementById('ot_ownerFax').value,
                ownerEmail: document.getElementById('ot_ownerEmail').value,
                ownerAddress: document.getElementById('ot_ownerAddress').value,
                ownerManager: document.getElementById('ot_ownerManager').value,
                ownerManagerPhone: document.getElementById('ot_ownerManagerPhone').value
            };

            const wb = XLSX.utils.book_new();
            const ws = [];
            for (let i = 0; i < 35; i++) ws.push(new Array(21).fill(null));

            ws[0][0] = '    ì˜¤í”¼ìŠ¤í…” ì…ì£¼ìì¹´ë“œ';
            ws[2][0]='í˜¸ìˆ˜'; ws[2][4]=d.unitNumber; ws[2][11]='ì…ì£¼ì¼'; ws[2][14]=d.moveInDate;
            ws[3][0]='ì„±ëª…'; ws[3][4]=d.residentName; ws[3][11]='ì „ì¶œì¼'; ws[3][14]=d.moveOutDate;
            const mt = d.moveInType;
            ws[4][0]='ì…ì£¼í˜•íƒœ'; ws[4][4]=`      ${mt==='ì†Œìœ '?'â˜‘':'â–¡'} ì†Œìœ     /     ${mt==='ìê°€'?'â˜‘':'â–¡'} ìê°€    ${mt==='ì „ì„¸'?'â˜‘':'â–¡'} ì „ì„¸    ${mt==='ì›”ì„¸'?'â˜‘':'â–¡'} ì›”ì„¸    ${mt==='ê¸°íƒ€'?'â˜‘':'â–¡'} ê¸°íƒ€`;
            ws[6][0]='ì¸ì ì‚¬í•­'; ws[6][1]='ìƒë…„ì›”ì¼'; ws[6][4]=d.birthDate; ws[6][11]='ìƒí˜¸'; ws[6][14]=d.businessName;
            ws[7][1]='ì „í™”ë²ˆí˜¸'; ws[7][4]=d.phoneNumber; ws[7][11]='ì‚¬ì—…ìë²ˆí˜¸'; ws[7][14]=d.businessNumber;
            ws[8][1]='í•¸ë“œí°'; ws[8][4]=d.mobilePhone; ws[8][11]='ì´ë©”ì¼'; ws[8][14]=d.email;
            ws[9][1]='TVë³´ìœ í˜„í™©'; ws[9][4]=`${d.hasTv==='ìœ '?'â˜‘':'â–¡'} ìœ    ${d.hasTv==='ë¬´'?'â˜‘':'â–¡'} ë¬´`; ws[9][11]='ì„¸ê¸ˆê³„ì‚°ì„œ'; ws[9][14]=`${d.taxInvoice==='ìœ '?'â˜‘':'â–¡'} ìœ    ${d.taxInvoice==='ë¬´'?'â˜‘':'â–¡'} ë¬´`;
            ws[11][0]='ê°€ì¡±/ì§ì›'; ws[11][1]='ì„±ëª…'; ws[11][4]='ìƒ ë…„ ì›” ì¼'; ws[11][9]='í•¸ ë“œ í°'; ws[11][14]='ë¹„          ê³ ';
            let fr = 12;
            for (let i = 0; i < Math.min(d.famNames.length, 5); i++) {
                if (d.famNames[i]||d.famBirths[i]||d.famPhones[i]||d.famNotes[i]) {
                    ws[fr][1]=d.famNames[i]||''; ws[fr][4]=d.famBirths[i]||''; ws[fr][9]=d.famPhones[i]||''; ws[fr][14]=d.famNotes[i]||''; fr++;
                }
            }
            ws[17][0]='ì†Œ ìœ  ì'; ws[17][1]='ìƒí˜¸'; ws[17][4]=d.ownerBizName; ws[17][8]='ì‚¬ì—…ìë²ˆí˜¸'; ws[17][11]=d.ownerBizNum; ws[17][15]='ì†Œìœ ì¼'; ws[17][18]=d.ownershipDate;
            ws[18][1]='ëŒ€í‘œì'; ws[18][4]=d.ownerRep; ws[18][11]='ìƒë…„ì›”ì¼'; ws[18][14]=d.ownerBirth;
            ws[19][1]='ì—…íƒœ'; ws[19][4]=d.ownerBizType; ws[19][11]='ì¢…ëª©'; ws[19][14]=d.ownerBizItem;
            ws[20][1]='ì „í™”ë²ˆí˜¸'; ws[20][4]=d.ownerPhone; ws[20][11]='íŒ©ìŠ¤ë²ˆí˜¸'; ws[20][14]=d.ownerFax;
            ws[21][1]='ì´ë©”ì¼'; ws[21][4]=d.ownerEmail;
            ws[22][1]='ì£¼ì†Œ'; ws[22][4]=d.ownerAddress;
            ws[23][1]='ë‹´ë‹¹ì'; ws[23][4]=d.ownerManager; ws[23][11]='ë‹´ë‹¹ìí•¸ë“œí°'; ws[23][14]=d.ownerManagerPhone;
            ws[25][0]='â€» ë³¸ ì¹´ë“œì— ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ ìš°ë¦¬ë‹¨ì§€ ê´€ë¦¬ì—…ë¬´ì—ë§Œ ì‚¬ìš©ë˜ë©° ì •ë³´í†µì‹ ë§ë³´í˜¸ë²•ì— ì˜ê±° ì™¸ë¶€ì— ìœ ì¶œë˜ì§€ ì•Šë„ë¡ í•˜ê² ìœ¼ë©° ì„¸ëŒ€ê°€ ì „ì¶œì‹œì—ëŠ” ì‹ë³„ë¶ˆê°€ëŠ¥í•˜ê²Œ íŒŒê¸°ë¥¼ í•˜ì˜¤ë‹ˆ ì•„ë˜ ì •ë³´ì´ìš© ë™ì˜ì„œì— ì„œëª…ì„ ë‹¹ë¶€ë“œë¦½ë‹ˆë‹¤.';
            ws[26][0]='ê°œì¸ì •ë³´ê´€ë¦¬ì±…ì„ì'; ws[26][4]='ê°œì¸ì •ë³´ ë³´í˜¸ì—…ë¬´ ë° ê´€ë ¨\nê³ ì¸µ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ì„œ'; ws[26][9]='ê´€ë¦¬ì§€ì›ì„¼í„° ì „í™”ë²ˆí˜¸'; ws[26][13]='ê´€ë¦¬ì§€ì›ì„¼í„° ì£¼ì†Œ'; ws[26][18]='ê´€ë¦¬íšŒì‚¬ëª…';
            ws[27][0]='ì¹´ë¦¼ì• ë¹„ë‰´ ì„¼í„°ì¥'; ws[27][4]='ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°'; ws[27][9]='031-378-2793'; ws[27][13]='ê²½ê¸°ë„ í™”ì„±ì‹œ ë™íƒ„ëŒ€ë¡œ 134\nì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°'; ws[27][18]='í•œë¹›ì¢…í•©ê´€ë¦¬ãˆœ';
            ws[28][0]='ì…ì£¼ìì¹´ë“œ ì •ë³´ì´ìš© ë™ì˜ì„œ';
            ws[29][0]='    ë³¸ì¸ ìí•„ë¡œ ì…ì£¼ìì¹´ë“œì–‘ì‹ì„ ì‘ì„±í•˜ë©° ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ë³¸ì¸ ë™ì˜ì—†ì´ ì™¸ë¶€ìœ ì¶œ, íƒ€ ìš©ë„ì— ì‚¬ìš©í•˜ì§€';
            ws[30][0]='    ì•Šê² ë‹¤ëŠ” ì¡°ê±´ìœ¼ë¡œ ê°œì¸ì •ë³´ì·¨ê¸‰ ë° ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘.ì´ìš©.ì œê³µ ë“±ì˜ ë‚´ìš©ì— ëŒ€í•˜ì—¬ ë™ì˜í•©ë‹ˆë‹¤.';
            const now = new Date();
            ws[31][0]=`20${now.getFullYear().toString().slice(-2)}     ë…„      ${now.getMonth()+1}       ì›”       ${now.getDate()}ì¼`;
            ws[31][13]='ì„±    ëª… : '; ws[31][16]=d.residentName; ws[31][19]='(ì¸)';
            ws[32][0]='â€» ì¹´ë¦¼ì• ë¹„ë‰´ ê´€ë¦¬ì§€ì›ì„¼í„°   TEL : 031-378-2793   FAX : 031-378-2794  E-mail : karim2793@naver.com â€»';

            const sheet = XLSX.utils.aoa_to_sheet(ws);
            sheet['!merges'] = [
                {s:{r:0,c:0},e:{r:1,c:20}},{s:{r:2,c:0},e:{r:2,c:3}},{s:{r:2,c:4},e:{r:2,c:10}},{s:{r:2,c:14},e:{r:2,c:20}},
                {s:{r:3,c:0},e:{r:3,c:3}},{s:{r:3,c:4},e:{r:3,c:10}},{s:{r:3,c:14},e:{r:3,c:20}},
                {s:{r:4,c:0},e:{r:4,c:3}},{s:{r:4,c:4},e:{r:4,c:20}},
                {s:{r:5,c:0},e:{r:5,c:20}},
                {s:{r:6,c:0},e:{r:9,c:0}},{s:{r:6,c:1},e:{r:6,c:3}},{s:{r:6,c:4},e:{r:6,c:10}},{s:{r:6,c:14},e:{r:6,c:20}},
                {s:{r:7,c:1},e:{r:7,c:3}},{s:{r:7,c:4},e:{r:7,c:10}},{s:{r:7,c:14},e:{r:7,c:20}},
                {s:{r:8,c:1},e:{r:8,c:3}},{s:{r:8,c:4},e:{r:8,c:10}},{s:{r:8,c:14},e:{r:8,c:20}},
                {s:{r:9,c:1},e:{r:9,c:3}},{s:{r:9,c:4},e:{r:9,c:10}},{s:{r:9,c:14},e:{r:9,c:20}},
                {s:{r:10,c:0},e:{r:10,c:20}},
                {s:{r:11,c:0},e:{r:16,c:0}},{s:{r:11,c:1},e:{r:11,c:3}},{s:{r:11,c:4},e:{r:11,c:8}},{s:{r:11,c:9},e:{r:11,c:13}},{s:{r:11,c:14},e:{r:11,c:20}},
                {s:{r:16,c:0},e:{r:16,c:20}},
                {s:{r:17,c:0},e:{r:23,c:0}},{s:{r:17,c:1},e:{r:17,c:3}},{s:{r:17,c:4},e:{r:17,c:7}},{s:{r:17,c:8},e:{r:17,c:10}},{s:{r:17,c:11},e:{r:17,c:14}},{s:{r:17,c:15},e:{r:17,c:17}},{s:{r:17,c:18},e:{r:17,c:20}},
                {s:{r:18,c:1},e:{r:18,c:3}},{s:{r:18,c:4},e:{r:18,c:10}},{s:{r:18,c:14},e:{r:18,c:20}},
                {s:{r:19,c:1},e:{r:19,c:3}},{s:{r:19,c:4},e:{r:19,c:10}},{s:{r:19,c:14},e:{r:19,c:20}},
                {s:{r:20,c:1},e:{r:20,c:3}},{s:{r:20,c:4},e:{r:20,c:10}},{s:{r:20,c:14},e:{r:20,c:20}},
                {s:{r:21,c:1},e:{r:21,c:3}},{s:{r:21,c:4},e:{r:21,c:20}},
                {s:{r:22,c:1},e:{r:22,c:3}},{s:{r:22,c:4},e:{r:22,c:20}},
                {s:{r:23,c:1},e:{r:23,c:3}},{s:{r:23,c:4},e:{r:23,c:10}},{s:{r:23,c:14},e:{r:23,c:20}},
                {s:{r:25,c:0},e:{r:25,c:20}},
                {s:{r:26,c:0},e:{r:26,c:3}},{s:{r:26,c:4},e:{r:26,c:8}},{s:{r:26,c:9},e:{r:26,c:12}},{s:{r:26,c:13},e:{r:26,c:17}},{s:{r:26,c:18},e:{r:26,c:20}},
                {s:{r:27,c:0},e:{r:27,c:3}},{s:{r:27,c:4},e:{r:27,c:8}},{s:{r:27,c:9},e:{r:27,c:12}},{s:{r:27,c:13},e:{r:27,c:17}},{s:{r:27,c:18},e:{r:27,c:20}},
                {s:{r:28,c:0},e:{r:28,c:20}},{s:{r:29,c:0},e:{r:29,c:20}},{s:{r:30,c:0},e:{r:30,c:20}},
                {s:{r:31,c:0},e:{r:31,c:11}},{s:{r:32,c:0},e:{r:32,c:20}}
            ];
            sheet['!cols'] = Array.from({length:21}, (_,i) => ({wch: i===0?10:8}));
            sheet['!rows'] = Array.from({length:35}, () => ({hpt:20}));
            XLSX.utils.book_append_sheet(wb, sheet, 'ì˜¤í”¼ìŠ¤í…”');
            XLSX.writeFile(wb, `${d.unitNumber}_${d.residentName}_ì˜¤í”¼ìŠ¤í…”.xlsx`);
            showSuccess('âœ“ Excel íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ============================================
        // ===== í‚¤ë¶ˆì¶œëŒ€ì¥ ê¸°ëŠ¥ =====
        // ============================================
        let keyLogRowCount = 1;

        function addKeyLogRow() {
            keyLogRowCount++;
            const tbody = document.getElementById('keyLogBody');
            const tr = document.createElement('tr');
            const today = new Date().toISOString().slice(0, 10);
            tr.innerHTML = `
                <td class="row-number">1</td>
                <td><input type="date" name="kl_date[]" value="${today}"></td>
                <td><input type="time" name="kl_time[]"></td>
                <td><input type="text" name="kl_name[]" placeholder="ì´ë¦„"></td>
                <td><input type="tel" name="kl_contact[]" placeholder="010-0000-0000"></td>
                <td><input type="text" name="kl_unit[]" placeholder="í˜¸ìˆ˜"></td>
                <td><input type="text" name="kl_reason[]" placeholder="ë¶ˆì¶œ ì‚¬ìœ "></td>
                <td><input type="time" name="kl_returnTime[]"></td>
                <td><button type="button" class="btn-remove-row" onclick="removeRow(this)">ì‚­ì œ</button></td>
            `;
            tbody.insertBefore(tr, tbody.firstChild);
            tr.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
            renumberRows('keyLogBody');
        }

        function saveKeyLogExcel() {
            const dates = Array.from(document.querySelectorAll('input[name="kl_date[]"]')).map(el => el.value);
            const times = Array.from(document.querySelectorAll('input[name="kl_time[]"]')).map(el => el.value);
            const names = Array.from(document.querySelectorAll('input[name="kl_name[]"]')).map(el => el.value);
            const contacts = Array.from(document.querySelectorAll('input[name="kl_contact[]"]')).map(el => el.value);
            const units = Array.from(document.querySelectorAll('input[name="kl_unit[]"]')).map(el => el.value);
            const reasons = Array.from(document.querySelectorAll('input[name="kl_reason[]"]')).map(el => el.value);
            const returnTimes = Array.from(document.querySelectorAll('input[name="kl_returnTime[]"]')).map(el => el.value);

            // ë¹ˆ í–‰ ì²´í¬
            let hasData = false;
            for (let i = 0; i < dates.length; i++) {
                if (dates[i] || names[i] || units[i]) { hasData = true; break; }
            }
            if (!hasData) { alert('ìµœì†Œ í•œ ê°œì˜ ê¸°ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const wb = XLSX.utils.book_new();
            const wsData = [];

            // íƒ€ì´í‹€
            wsData.push(['í‚¤ë¶„ì¶œëŒ€ì¥ (ë‹¹ì¼ë¶ˆì¶œìš©)']);
            wsData.push([]);
            // í—¤ë”
            wsData.push(['ì¼ì\n(ë…„,ì›”,ì¼)', 'ì‹œê°„', 'ì´ë¦„', 'ì—°ë½ì²˜', 'í˜¸ìˆ˜', 'ë¶ˆì¶œ ì‚¬ìœ (ì˜ˆ: 000í˜¸ ê³µì‚¬)', 'ë°˜ë‚© ì‹œê°„']);

            // ë°ì´í„° í–‰
            for (let i = 0; i < dates.length; i++) {
                if (dates[i] || names[i] || units[i] || contacts[i] || reasons[i]) {
                    wsData.push([dates[i], times[i], names[i], contacts[i], units[i], reasons[i], returnTimes[i]]);
                }
            }

            // ë¹ˆ í–‰ ì¶”ê°€ (ìµœì†Œ 20í–‰)
            const currentRows = wsData.length;
            for (let i = currentRows; i < 24; i++) {
                wsData.push(['', '', '', '', '', '', '']);
            }

            const sheet = XLSX.utils.aoa_to_sheet(wsData);
            
            // ë³‘í•©: íƒ€ì´í‹€
            sheet['!merges'] = [
                {s:{r:0,c:0}, e:{r:0,c:6}}
            ];

            // ì—´ ë„ˆë¹„
            sheet['!cols'] = [
                {wch: 14}, // ì¼ì
                {wch: 10}, // ì‹œê°„
                {wch: 12}, // ì´ë¦„
                {wch: 16}, // ì—°ë½ì²˜
                {wch: 10}, // í˜¸ìˆ˜
                {wch: 28}, // ë¶ˆì¶œ ì‚¬ìœ 
                {wch: 10}  // ë°˜ë‚© ì‹œê°„
            ];

            XLSX.utils.book_append_sheet(wb, sheet, 'í‚¤ë¶„ì¶œ');

            const now = new Date();
            const dateStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
            XLSX.writeFile(wb, `í‚¤ë¶„ì¶œëŒ€ì¥_${dateStr}.xlsx`);
            showSuccess('âœ“ í‚¤ë¶ˆì¶œëŒ€ì¥ Excel íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function saveKeyLogPDF() {
            generatePDF('.container', `í‚¤ë¶„ì¶œëŒ€ì¥_${new Date().toISOString().slice(0,10)}.pdf`, null);
        }

        function resetKeyLog() {
            if (!confirm('í‚¤ë¶ˆì¶œëŒ€ì¥ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const tbody = document.getElementById('keyLogBody');
            tbody.innerHTML = `
                <tr>
                    <td class="row-number">1</td>
                    <td><input type="date" name="kl_date[]"></td>
                    <td><input type="time" name="kl_time[]"></td>
                    <td><input type="text" name="kl_name[]" placeholder="ì´ë¦„"></td>
                    <td><input type="tel" name="kl_contact[]" placeholder="010-0000-0000"></td>
                    <td><input type="text" name="kl_unit[]" placeholder="í˜¸ìˆ˜"></td>
                    <td><input type="text" name="kl_reason[]" placeholder="ë¶ˆì¶œ ì‚¬ìœ "></td>
                    <td><input type="time" name="kl_returnTime[]"></td>
                    <td></td>
                </tr>`;
            keyLogRowCount = 1;
            tbody.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
        }

        // ============================================
        // ===== ê³µê¸°êµ¬ëŒ€ì—¬ ê´€ë¦¬ëŒ€ì¥ ê¸°ëŠ¥ =====
        // ============================================
        let toolRentalRowCount = 1;

        function addToolRentalRow() {
            toolRentalRowCount++;
            const tbody = document.getElementById('toolRentalBody');
            const tr = document.createElement('tr');
            const today = new Date().toISOString().slice(0, 10);
            tr.innerHTML = `
                <td class="row-number">1</td>
                <td><input type="date" name="tr_date[]" value="${today}"></td>
                <td><input type="text" name="tr_unit[]" placeholder="í˜¸ì‹¤/ìƒí˜¸"></td>
                <td><input type="text" name="tr_name[]" placeholder="ì´ë¦„"></td>
                <td><input type="tel" name="tr_contact[]" placeholder="010-0000-0000"></td>
                <td><input type="text" name="tr_tool[]" placeholder="ëŒ€ì—¬ ê³µêµ¬ ëª…"></td>
                <td><input type="time" name="tr_returnTime[]"></td>
                <td><input type="text" name="tr_signature[]" placeholder="ì„œëª…"></td>
                <td><button type="button" class="btn-remove-row" onclick="removeRow(this)">ì‚­ì œ</button></td>
            `;
            tbody.insertBefore(tr, tbody.firstChild);
            tr.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
            renumberRows('toolRentalBody');
        }

        function saveToolRentalExcel() {
            const dates = Array.from(document.querySelectorAll('input[name="tr_date[]"]')).map(el => el.value);
            const units = Array.from(document.querySelectorAll('input[name="tr_unit[]"]')).map(el => el.value);
            const names = Array.from(document.querySelectorAll('input[name="tr_name[]"]')).map(el => el.value);
            const contacts = Array.from(document.querySelectorAll('input[name="tr_contact[]"]')).map(el => el.value);
            const tools = Array.from(document.querySelectorAll('input[name="tr_tool[]"]')).map(el => el.value);
            const returnTimes = Array.from(document.querySelectorAll('input[name="tr_returnTime[]"]')).map(el => el.value);
            const signatures = Array.from(document.querySelectorAll('input[name="tr_signature[]"]')).map(el => el.value);

            // ë¹ˆ í–‰ ì²´í¬
            let hasData = false;
            for (let i = 0; i < dates.length; i++) {
                if (dates[i] || names[i] || units[i] || tools[i]) { hasData = true; break; }
            }
            if (!hasData) { alert('ìµœì†Œ í•œ ê°œì˜ ê¸°ë¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const wb = XLSX.utils.book_new();
            const wsData = [];

            // íƒ€ì´í‹€
            wsData.push(['ê³µê¸°êµ¬ ëŒ€ì—¬ ê´€ë¦¬ ëŒ€ì¥']);
            wsData.push([]);
            // í—¤ë” (2í–‰ - ë³‘í•© êµ¬ì¡° ë°˜ì˜)
            wsData.push(['ì¼ì\n(ë…„,ì›”,ì¼)', 'í˜¸ì‹¤ / ìƒí˜¸', 'ì´ë¦„', 'ì—°ë½ì²˜', 'ëŒ€ì—¬ ê³µêµ¬ ëª…', 'ë°˜ë‚©í™•ì¸', '']);
            wsData.push(['', '', '', '', '', 'ë°˜ë‚©ì‹œê°„', 'í™•ì¸ì„œëª…']);

            // ë°ì´í„° í–‰
            for (let i = 0; i < dates.length; i++) {
                if (dates[i] || names[i] || units[i] || tools[i] || contacts[i]) {
                    wsData.push([dates[i], units[i], names[i], contacts[i], tools[i], returnTimes[i], signatures[i]]);
                }
            }

            // ë¹ˆ í–‰ ì¶”ê°€ (ìµœì†Œ 17í–‰)
            const currentRows = wsData.length;
            for (let i = currentRows; i < 17; i++) {
                wsData.push(['', '', '', '', '', '', '']);
            }

            const sheet = XLSX.utils.aoa_to_sheet(wsData);

            // ë³‘í•©
            sheet['!merges'] = [
                {s:{r:0,c:0}, e:{r:0,c:6}},   // íƒ€ì´í‹€
                {s:{r:2,c:0}, e:{r:3,c:0}},   // ì¼ì
                {s:{r:2,c:1}, e:{r:3,c:1}},   // í˜¸ì‹¤/ìƒí˜¸
                {s:{r:2,c:2}, e:{r:3,c:2}},   // ì´ë¦„
                {s:{r:2,c:3}, e:{r:3,c:3}},   // ì—°ë½ì²˜
                {s:{r:2,c:4}, e:{r:3,c:4}},   // ëŒ€ì—¬ ê³µêµ¬ ëª…
                {s:{r:2,c:5}, e:{r:2,c:6}}    // ë°˜ë‚©í™•ì¸ (ìƒìœ„ ë³‘í•©)
            ];

            // ì—´ ë„ˆë¹„
            sheet['!cols'] = [
                {wch: 14}, // ì¼ì
                {wch: 14}, // í˜¸ì‹¤/ìƒí˜¸
                {wch: 12}, // ì´ë¦„
                {wch: 16}, // ì—°ë½ì²˜
                {wch: 18}, // ëŒ€ì—¬ ê³µêµ¬ ëª…
                {wch: 12}, // ë°˜ë‚©ì‹œê°„
                {wch: 12}  // í™•ì¸ì„œëª…
            ];

            XLSX.utils.book_append_sheet(wb, sheet, 'ê³µê¸°êµ¬ëŒ€ì—¬');

            const now = new Date();
            const dateStr = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
            XLSX.writeFile(wb, `ê³µê¸°êµ¬ëŒ€ì—¬_ê´€ë¦¬ëŒ€ì¥_${dateStr}.xlsx`);
            showSuccess('âœ“ ê³µê¸°êµ¬ëŒ€ì—¬ ê´€ë¦¬ëŒ€ì¥ Excel íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function saveToolRentalPDF() {
            generatePDF('.container', `ê³µê¸°êµ¬ëŒ€ì—¬_ê´€ë¦¬ëŒ€ì¥_${new Date().toISOString().slice(0,10)}.pdf`, null);
        }

        function resetToolRental() {
            if (!confirm('ê³µê¸°êµ¬ëŒ€ì—¬ ê´€ë¦¬ëŒ€ì¥ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const tbody = document.getElementById('toolRentalBody');
            tbody.innerHTML = `
                <tr>
                    <td class="row-number">1</td>
                    <td><input type="date" name="tr_date[]"></td>
                    <td><input type="text" name="tr_unit[]" placeholder="í˜¸ì‹¤/ìƒí˜¸"></td>
                    <td><input type="text" name="tr_name[]" placeholder="ì´ë¦„"></td>
                    <td><input type="tel" name="tr_contact[]" placeholder="010-0000-0000"></td>
                    <td><input type="text" name="tr_tool[]" placeholder="ëŒ€ì—¬ ê³µêµ¬ ëª…"></td>
                    <td><input type="time" name="tr_returnTime[]"></td>
                    <td><input type="text" name="tr_signature[]" placeholder="ì„œëª…"></td>
                    <td></td>
                </tr>`;
            toolRentalRowCount = 1;
            tbody.querySelectorAll('input[type="tel"]').forEach(i => i.addEventListener('input', function() { formatPhoneNumber(this); }));
        }

        // ===== ê³µí†µ: í–‰ ì‚­ì œ & ë²ˆí˜¸ ì¬ì •ë ¬ =====
        function removeRow(btn) {
            const tr = btn.closest('tr');
            const tbody = tr.parentElement;
            if (tbody.children.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ í–‰ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            tr.remove();
            renumberRows(tbody.id);
        }

        function renumberRows(tbodyId) {
            const tbody = document.getElementById(tbodyId);
            const rows = tbody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                row.querySelector('.row-number').textContent = index + 1;
            });
        }

        // ===== ê³µí†µ ìœ í‹¸ë¦¬í‹° =====
        function formatPhoneNumber(input) {
            let value = input.value.replace(/[^0-9]/g, '');
            if (value.startsWith('02')) {
                if (value.length > 2 && value.length <= 5) value = value.replace(/(\d{2})(\d+)/, '$1-$2');
                else if (value.length > 5) value = value.replace(/(\d{2})(\d{3,4})(\d+)/, '$1-$2-$3');
            } else if (value.startsWith('01')) {
                if (value.length > 3 && value.length <= 7) value = value.replace(/(\d{3})(\d+)/, '$1-$2');
                else if (value.length > 7) value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            } else {
                if (value.length > 3 && value.length <= 6) value = value.replace(/(\d{3})(\d+)/, '$1-$2');
                else if (value.length > 6) value = value.replace(/(\d{3})(\d{3,4})(\d+)/, '$1-$2-$3');
            }
            input.value = value;
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[type="tel"]').forEach(input => {
                input.addEventListener('input', function() { formatPhoneNumber(this); });
            });

            ['sg_businessNumber', 'sg_ownerBusinessNumber', 'ot_businessNumber', 'ot_ownerBusinessNumber'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function() {
                        let v = this.value.replace(/[^0-9]/g, '');
                        if (v.length > 3 && v.length <= 5) v = v.replace(/(\d{3})(\d+)/, '$1-$2');
                        else if (v.length > 5) v = v.replace(/(\d{3})(\d{2})(\d+)/, '$1-$2-$3');
                        this.value = v.substring(0, 12);
                    });
                }
            });

            // ì˜¤ëŠ˜ ë‚ ì§œë¡œ í‚¤ë¶ˆì¶œëŒ€ì¥ ì²« í–‰ ê¸°ë³¸ê°’ ì„¤ì •
            const today = new Date().toISOString().slice(0, 10);
            const klDateInputs = document.querySelectorAll('input[name="kl_date[]"]');
            if (klDateInputs.length > 0 && !klDateInputs[0].value) {
                klDateInputs[0].value = today;
            }
            const trDateInputs = document.querySelectorAll('input[name="tr_date[]"]');
            if (trDateInputs.length > 0 && !trDateInputs[0].value) {
                trDateInputs[0].value = today;
            }
        });
    </script>
</body>
</html>
